---
title: "Lab 02 Deliverables"
author: "Yukun"
date: "4/12/2022"
output:
  html_document:
    theme: flatly
    toc: TRUE
    toc_float: TRUE
    toc_depth: 2
    number_sections: TRUE
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Workflow for Lab 02

The lab instructions can be found [here](https://stevenbedrick.github.io/data-vis-labs-2022/02-moma.html); we will work through its contents together via Webex. You will use this RMarkdown file as your workspace and final document. Don't forget to update the "author" metadata field at the top of the file!

# Start by Loading Libraries

```{r load-packages, include=FALSE}
library(readr)
library(here)
library(tidyverse)
library(ggthemes)
```

# Know Your Data

## How Many Paintings?

```{r}
library(dplyr)
moma <- read_csv(here::here("data","artworks-cleaned.csv"),show_col_types = FALSE)

sprintf("There are %1.0f paintings",count(moma))
moma
```

## What is the first painting that was acquired?

```{r}

moma_first = moma %>% 
  select(artist, title, year_acquired) %>% 
  arrange(year_acquired)

sprintf("The first painting was acquires is %s (%s) acquired in %d",moma_first$title[1],moma_first$artist[1],moma_first$year_acquired[1])
moma_first
```

## What is the oldest painting?

```{r}
moma_odest = moma %>% 
  select(artist, title, year_created) %>% 
  arrange(year_created)

sprintf("The odest painting is %s painted by %s in %d",moma_odest$title[1],moma_odest$artist[1],moma_odest$year_created[1])
moma_odest
```

## How many artists?
```{r}
moma_artists_num = moma %>% 
  distinct(artist)%>%
  tally()

sprintf("There are %1.0f artists",moma_artists_num)
moma_artists_num
```

## Which artist ahs the most paintings?
```{r}
moma_artists = moma %>% 
  select(artist)%>%
  group_by(artist)%>%
  count()%>%
  arrange(desc(n))
# moma_artists = moma %>%count(artist, sort = TRUE)
sprintf('%s has the most paintings (%d paintings).',moma_artists$artist[1],moma_artists$paintings[1])
moma_artists_num
```

## How many paintings, by gender?
```{r}
moma %>% 
  count(artist_gender)
```

## How many artists, by gender?
```{r}
moma %>% 
  count(artist_gender,artist)%>%
  count(artist_gender)
```

## In which years were the most paintings in the collection *acquired*?
```{r}
moma_most = moma%>%count(year_acquired,sort=TRUE)
sprintf("The year with the most collected paintings %d",moma_most$year_acquired[1])
```

## In which years were the most paintings in the collection *created*?
```{r}
moma_most = moma%>%count(year_created,sort=TRUE)
sprintf("The year with the most created paintings %d",moma_most$year_created[1])
```

## What about the first painting by a solo female artist?
```{r}
moma_f = moma%>%filter(num_artists == 1 & n_female_artists == 1) %>% 
  select(title, artist, year_acquired, year_created) %>% 
  arrange(year_acquired)

```

# Basic Plotting!

## Year painted vs. year acquired
```{r}
ggplot(moma,aes(year_created,year_acquired))+
  geom_point(alpha=0.1, na.rm = TRUE)+
  geom_abline(intercept = c(0,0),color="red") + 
  labs(x="Year Painted", y = "Year acquired") +
  ggtitle("MoMA Keeps Its Collection Current")
```

## Faceting by gender
```{r}
moma_solo <- moma %>% 
  filter(num_artists == 1)

ggplot(moma_solo, aes(year_created, year_acquired))+
  geom_point(alpha = .1) +
  geom_abline(intercept = c(0,0), colour = "red")+
  labs(x = "Year Painted", y = "Year Acquired") +
  ggtitle("MoMA Keeps Its Collection Current") +
  facet_wrap(~artist_gender)
```

# Exploring Painting Dimensions

## Challenge #4
```{r}
moma_dim <- moma %>% 
  filter(height_cm < 600, width_cm < 760) %>% 
  mutate(hw_ratio = height_cm / width_cm,
         hw_cat = case_when(
           hw_ratio > 1 ~ "taller than wide",
           hw_ratio < 1 ~ "wider than tall",
           hw_ratio == 1 ~ "perfect square"
         ))

library(ggthemes)
ggplot(moma_dim, aes(x = width_cm, y = height_cm, colour = hw_cat)) +
  geom_point(alpha = .5) +
  ggtitle("MoMA Paintings, Tall and Wide") +
  scale_colour_manual(name = "",
                      values = c("gray50", "#FF9900", "#B14CF0")) +
  theme_fivethirtyeight() +
  theme(axis.title = element_text()) +
  labs(x = "Width", y = "Height") 
```

## Different colors
```{r}
ggplot(moma_dim, aes(x = width_cm, y = height_cm, colour = hw_cat)) +
  geom_point(alpha = .5) +
  ggtitle("MoMA Paintings, Tall and Wide") +
  scale_colour_manual(name = "", values = c("gray50", "#ee5863", "#6999cd")) +
  theme_fivethirtyeight() +
  theme(axis.title = element_text()) +
  labs(x = "Width", y = "Height") 
```

## Experimenting with `geom_annotate()`
```{r}
ggplot(moma_dim, aes(x = width_cm, y = height_cm, colour = hw_cat)) +
  geom_point(alpha = .5, show.legend = FALSE) +
  ggtitle("MoMA Paintings, Tall and Wide") +
  scale_colour_manual(name = "",
                      values = c("gray50", "#ee5863", "#6999cd")) +
  theme_fivethirtyeight() +
  theme(axis.title = element_text()) +
  labs(x = "Width", y = "Height") +
  annotate(x = 200, y = 380, geom = "text", 
           label = "Taller than\nWide", color = "#ee5863", 
           size = 5, family = "Lato", hjust = 1, fontface = 2) +
    annotate(x = 375, y = 100, geom = "text", 
             label = "Wider than\nTall", color = "#6999cd", 
             size = 5, family = "Lato", hjust = 0, fontface = 2)
```

# Challenge #5, on your own!
```{r}
moma_c <- moma%>%
  filter(num_artists == 1) %>%
  mutate(age_created=year_created-artist_birth_year)%>%
  subset(!is.na(age_created))

ggplot(moma_c,aes(age_created,fill=artist_gender))+
  geom_histogram(binwidth=4,color="white",position="dodge")+
  scale_x_continuous(breaks=seq(0,90,5))+
  theme(legend.position="right")+
  labs(x = "Age", y = "Paintings")+
  scale_fill_manual(values = c("#ee5863", "#6999cd"), name = "Artist Gender")+
  ggtitle("The most productive age of an artist is 34~36")+
      annotate(x = 36.5, y = 260, geom = "text", 
             label = "*", color = "#6999cd", 
             size = 5, family = "Lato", hjust = 0, fontface = 2)+
        annotate(x = 34.5, y = 40, geom = "text", 
             label = "*", color = "#ee5863", 
             size = 5, family = "Lato", hjust = 0, fontface = 2)
  
  
```

```{r , include=FALSE}
moma_c <- moma

moma_c$typed = as.integer(moma_c$purchase)+as.integer(moma_c$gift)*2+as.integer(moma_c$exchange)*3;
moma_c <-subset(moma_c, (!is.na(moma_c$typed)))
moma_c$typed = as.factor(moma_c$typed)

ggplot(moma_c,aes(year_acquired,fill=typed))+geom_histogram()
```

```{r , include=FALSE}
moma_c <- moma
moma_c$country <- str_extract(moma$artist_bio,"[A-Za-z]+") 
moma_c$decades <- sprintf('%d',floor(moma$year_created/10))
na.omit(moma_c$decades)

moma_c

#1870-2020
m = moma_c %>%
  filter(num_artists==1,) %>%
  select(country,decades)%>%
  count(country, decades)%>%
  group_by(decades)%>%
  arrange(n,.by_group = TRUE)%>%
  top_n(3)

ggplot(m ,aes(x=decades,y=n,colour=country))+
  geom_point()+geom_line()


```



